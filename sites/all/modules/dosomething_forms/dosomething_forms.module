<?

/**
 * Implementation of hook_form_alter()
*/
function dosomething_forms_form_alter(&$form, &$form_state, $form_id) {
  //
  // contenttype node form
  //
  if (substr($form_id, -10) == '_node_form') {

    //$form['body_field']['body']['#rows'] = 5;
    $form['body_field']['body']['#resizable'] = TRUE;
    
    // remove "split summary at cursor" button and related elements if necessary
    $form['body_field']['#after_build'] = NULL;
    $form['body_field']['teaser_js'] = NULL;
    $form['body_field']['teaser_include'] = NULL;
  }
  switch ($form_id) {
    case 'scholarships_att_node_form':
      $form['group_your_media']['field_scholarship_att_pic']['#prefix'] = '<p>Picture (recommended): show us a picture of yourself showcasing your personality, style, and excitement about a DoSomething.org/AT&T scholarship!</p>';
      $form['preview']['#access'] = false;
      $form['group_your_media']['field_scholarship_att_pic']['#suffix'] = '<div class="media-upload-note">The video and/or picture you upload in connection with your application will be posted on our gallery tab which is viewable to the public.  By uploading your video and/or picture to this site, you represent and warrant: (i) you have obtained all rights, licenses, consents and permission to use the content featured in the video/photo, including but not limited to, those of any persons that may have participated in the video or are recognizable in the photo; (ii) the video, in whole or in part, has not been released commercially; and (iii) the video/photo does not and will not violate any third party rights.</div>';

    break;
  }

}

function dosomething_forms_nodeapi(&$node, $op, $a3 = NULL, $a4 = NULL) {
  global $user;

  switch($node->type) {
    case 'ebd_signup':
    drupal_set_message($op);
      if ($op == 'presave') {
        dia_signup(array(
                     'link' => 'groups',
                     'table' => 'supporter',
                     'linkKey' => 100755,
                     'Organization' => $_POST['title'],
                 ));
      }
    break;
  }

}


function dia_signup ($args = array()) {

  global $user;
  $user = user_load(array('uid' => $user->uid));

  $ch = curl_init();

  $default_data = array(
    'First_Name' => $user->profile_fname,
    'Last_Name' => $user->profile_lname,
    'Organization' => $_POST['title'],
    'Email' => $user->mail,
    'Phone' => $user->profile_cell,
    'State' => $user->profile_state,
    'Zip' => $user->profile_zip,
    'link' => 'groups',
    'linkKey' => '',
    'table' => 'supporter',
    'organization_KEY' => '5216'
    );

  $data = array();
  $data = array_merge($default_data, $args);

  $items = array();
  foreach($data as $key=>$item){
    if ($item != '') {
      $items[] = $key.'='.$item;
    }
  }

  $string = "?".implode('&',$items);

  $msg = 'Going to: http://org2.democracyinaction.org/dia/api/process.jsp'.rawurlencode($string);

  curl_setopt($ch, CURLOPT_URL, 'http://org2.democracyinaction.org/dia/api/process.jsp'.rawurlencode($string));
  curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
  $return = 1;
  if (curl_exec($ch) === false) {
    $msg .= 'Curl error: '.curl_error($ch);
    $return = 0;
  }
  //drupal_set_message($msg);

  return $return;

}


?>
